#cloud-config
hostname: pi-homelab
create_hostname_file: true
manage_etc_hosts: true
timezone: Europe/Madrid
keyboard:
    model: pc105
    layout: es
write_files:
    - path: /etc/sysctl.d/99-tailscale.conf
      owner: root:root
      permissions: "0644"
      content: |
        net.ipv4.ip_forward = 1
        net.ipv6.conf.all.forwarding = 1
    - path: /etc/networkd-dispatcher/routable.d/50-tailscale
      owner: root:root
      permissions: "0755"
      content: |
        #!/bin/sh
        ethtool -K eth0 rx-udp-gro-forwarding on rx-gro-list off
    - path: /root/tailscale.authkey
      owner: root:root
      permissions: "0600"
      # sops-encrypt
      content: ENC[AES256_GCM,data:3RHlDyKWNRMk8OsdyhHFFf6TMLLlx1e9gke7SZlNRWEzOfNxrYg/eFv8toQ3xa0fZjuPVZQSi0Tmik+4YH3Qdfw=,iv:4SP+9R7XD3Ze6/M7lFlPqzZYGfIiGbO7MwjMddkjAAU=,tag:4yfgUOsln6+Ct7orfp7bnQ==,type:str]
    - path: /home/teixe/gpg-secret.asc
      owner: teixe:teixe
      permissions: "0600"
      # sops-encrypt
      content: ENC[AES256_GCM,data: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,iv:Wu/Nu0v4uadPNpH0Iq9B8zUnumxnDJsm31hJC2y15ok=,tag:KajBsWtBKPD4bNuzoixoaw==,type:str]
ssh_deletekeys: false
ssh_keys:
    # sops-encrypt
    ed25519_private: ENC[AES256_GCM,data:LI8Eb5JjFg3490eHcYGdPYznYcBTYxX80bwWi1hMobWM+oI5FX9aS29a1h70kyg/R5L61nlfuabu3ZYcCI2SHmj9JV+p6E+4xMQMhkN20991KXnkiiPwrdg5BIzmadcszHrOYrnmzSBp5LrwjQmZkl5j6qw4IfU/AlWuNTcsnRgCe4hhQhQ+t/ESa1iBryQx4rQ6iqntVHdjLer31HWxwJ43BlhjbswHbpoOIN2oWARlKoDDvLMTWld9Fr2iRMXCNlw7CNEL8mWf8fj2ReuWGWQJdLK2uuu5B7PoR3TL8tX0pG011XNu3bC7TRbIg7bsFmsBulXMQc8FICWY1zB2CliBThVc0XuOM6cIaRRpaOL2WXkha3Uh7I4wuMglEsqqODTOP3FoMS91cR2JZzSHslqhHx7lfJ32WkMjQrR7y2VGGIk2n3u1gzy+uLZP6lmMlu2L6ANeG8mohuRxFLQVWlV9BhgOTydzFHMzUEJhfgQrY82ardNja2AOwyZ8A6YlIKqh4X4396wyIoxPnfJJENgqUHLXSDYm/nJH,iv:QgG8Y/ICpAnaB+da2Illv66ME5u6o6y4yCxmsCDhukI=,tag:YJt0++jEzOE8Def7Y0BPMA==,type:str]
    ed25519_public: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIObYWV2oByM30vYbEEF6v2LBNaiVLeNrRpDFHC6ZY4Rd
groups:
    - docker
users:
    - name: teixe
      gecos: Jorge Teixeira
      groups: users,adm,dialout,audio,netdev,video,plugdev,cdrom,games,input,gpio,spi,i2c,render,sudo,docker
      shell: /bin/bash
      ssh_import_id:
        - gh:jorgeteixe
      sudo: ALL=(ALL) NOPASSWD:ALL
apt:
    sources:
        docker:
            source: deb [arch=arm64 signed-by=$KEY_FILE] https://download.docker.com/linux/ubuntu $RELEASE stable
            keyid: 9DC858229FC7DD38854AE2D88D81803C0EBFCD88
        tailscale:
            source: deb [arch=arm64 signed-by=$KEY_FILE] https://pkgs.tailscale.com/stable/ubuntu $RELEASE main
            keyid: 2596A99EAAB33821893C0A79458CA832957F5868
package_update: true
package_upgrade: true
package_reboot_if_required: true
packages:
    - iptables-persistent
    - apt-transport-https
    - curl
    - gnupg
    - git
    - just
    - docker-ce
    - docker-ce-cli
    - containerd.io
    - docker-compose-plugin
    - tailscale
runcmd:
    - su - teixe -c 'gpg --import /home/teixe/gpg-secret.asc'
    - su - teixe -c 'echo "D5F7F738DAA8032D5B6CD6DB5BB088B9813BF479:6:" | gpg --import-ownertrust'
    - rm /home/teixe/gpg-secret.asc
    - service procps force-reload
    - /etc/networkd-dispatcher/routable.d/50-tailscale
    - systemctl enable --now docker
    - curl -L https://github.com/getsops/sops/releases/download/v3.10.2/sops-v3.10.2.linux.arm64 -o /usr/local/bin/sops
    - chmod 755 /usr/local/bin/sops
    - tailscale up --ssh --accept-routes --advertise-tags=tag:homelab-host --advertise-exit-node --advertise-routes=172.20.10.0/24 --authkey $(cat /root/tailscale.authkey)
    - mkdir -p /etc/iptables
    - iptables -t raw -I PREROUTING 1 -i tailscale0 -d 172.20.10.0/24 -j ACCEPT
    - iptables-save > /etc/iptables/rules.v4
    - git clone https://github.com/jorgeteixe/homelab.git /home/teixe/homelab
    - chown -R teixe:teixe /home/teixe/homelab
final_message: System configured after $UPTIME seconds
sops:
    lastmodified: "2025-07-25T20:45:50Z"
    mac: ENC[AES256_GCM,data:q8IgpTnQp7Vdq5CumGxNlfsW6MFt5WPNu8KELLcurHkn8XFvXzSe/iPw8XIPG2K8YwBnwAWYkeVSINvIZalEKZ6KxlSw4LMKU3Cdjd4c7ba3p5RFpq6zu/28Gg9VVDLwt98i9+Ifl07ZyViLeAh61fM+t5gohG5n4grzJ0B7Ldk=,iv:E35RkaQhfvfNpCA+tae5q/BQ3dj3+qfI1PPYUdklnuc=,tag:aiLNGgZqIi/8pvS+HqwJTQ==,type:str]
    pgp:
        - created_at: "2025-07-25T20:45:50Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hF4DR/nonxQYTxwSAQdA/vbXMbucozJxotffF2vXg20f+visSVgYTeDEUEaYXCEw
            5bGkxF7MQUBpj7ETs8CzHEi2u2SKNmxSc/36quuJTsvXzK5PqgbwYFyi4ck4T3bl
            1GgBCQIQtADa+ScL9nD/spySn/Lk9/n0lqRv8wV9SX8FAzjoDCKWC8dDXtSfEwt8
            no1drNniEv8e/GESzc3hf29a8QPi/+bIp68BTMZY0KKzSLY+/BdR3INnbYOw4+Ge
            YoMHr+A/BQInqg==
            =jcCZ
            -----END PGP MESSAGE-----
          fp: DB6C87F1F82881C053A9692F775C24835DEA222F
        - created_at: "2025-07-25T20:45:50Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA1PyvA0ZNFOVAQ//cjQhz5rESx3u0MCIY1SzcqOeWDt5mEO3fdbjIl/+qo8W
            wgxjA8E2moRW7uWPIT5kkwzrjdwygXRQwRSscx3DDyxX9OpYjXED+asqagbA7G43
            3fRf731/6Fd5OYHxqi5CecvzXAntWmGAPuZrVd/2RxekrVm7wEonFKFTNFiS6eqR
            VO8JlX/2NM6R2MXOHlPvF1mLrQ7axFmyEMmuxkh1+2vRSVacbxki9lkJE65yLmJ6
            oAFh46tPQX00i+1lgmX9jgCTXOgkbmWjZBbpJDaqiS+yZ3YYb9eKKkwK321C8f5a
            NesKNZ0zJewiZXSKAxlvARrGD+JSiOMkoFLjANDcQVboeMObzxo9Phaz7E/VsXv0
            f4Uel+ws5hnlc9s6sWRvxC6Gt5yZoYN+Gf2nJnZoWPkKk7VXQAyitvA2PsVgkUQy
            Ub+9pPMm9PcRae/U81piltcmxkASHCVQNiTc7vUpUGtiBtfsznQTWZoE9DgMd590
            EB8m4yAoXtzuaAY3btebaFnvo/cqgAH8FnXZGXGiyIQJLVQg1SLsQwHitG/JAQzO
            MiGu6p+nStcBYQaQ5GhjbvVPIqGsuLQcRYyvcHF+rpP2Ph0yKEpOJNZPc6sKMBMO
            nSILOWSyjOOnUromFxLNMnn9FTn6axLF2feHGCaxUGRFT3hABUb68/59ypwDk9bU
            aAEJAhCKoGLGJxSTFEfo7dtGyZFh7ROLKTD5FzuIfr+00xw+3NS4P3MV1h54ypHl
            1h+x5DdArZq1zN4wsJUFQzNNDyN1uyGlU0g3zrLAq2+/KrDdG2ZiFExitOozbCoz
            L1NMvqF52/KH
            =8ZQh
            -----END PGP MESSAGE-----
          fp: D5F7F738DAA8032D5B6CD6DB5BB088B9813BF479
    encrypted_comment_regex: sops-encrypt
    version: 3.10.2
