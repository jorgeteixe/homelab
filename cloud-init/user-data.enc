#cloud-config
hostname: pi-homelab
create_hostname_file: true
manage_etc_hosts: true
timezone: Europe/Madrid
keyboard:
    model: pc105
    layout: es
write_files:
    - path: /etc/systemd/network/99-homelab-macvlan.netdev
      owner: root:root
      permissions: "0644"
      content: |
        [NetDev]
        Name=homelab-link
        Kind=macvlan

        [MACVLAN]
        Mode=bridge
        Parent=eth0
    - path: /etc/systemd/network/99-homelab-macvlan.network
      owner: root:root
      permissions: "0644"
      content: |
        [Match]
        Name=homelab-link

        [Network]
        Address=172.20.10.1/24
    - path: /etc/sysctl.d/99-tailscale.conf
      owner: root:root
      permissions: "0644"
      content: |
        net.ipv4.ip_forward = 1
        net.ipv6.conf.all.forwarding = 1
    - path: /etc/networkd-dispatcher/routable.d/50-tailscale
      owner: root:root
      permissions: "0755"
      content: |
        #!/bin/sh
        ethtool -K eth0 rx-udp-gro-forwarding on rx-gro-list off
    - path: /root/tailscale.authkey
      owner: root:root
      permissions: "0600"
      # sops-encrypt
      content: ENC[AES256_GCM,data:r5+7mf4yQzAmAk+C++Ugj5o1rWnMhC0SNt+uFHACTr36It6AhKxV4WvHU5pPwkSIbUJrH114idnXsakRR6BUsrA=,iv:tKw+V2BGSL0HwQIcXbwXoVoFw3iBhChd6G66iYq/Dqc=,tag:B5Ns9hHf7Ea7CDTv6pvQ/w==,type:str]
    - path: /home/teixe/gpg-secret.asc
      owner: teixe:teixe
      permissions: "0600"
      # sops-encrypt
      content: ENC[AES256_GCM,data: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,iv:sUsbOUqLtPBUHsxbKna8Ym7f7K9umxlBcrePVKdJRsY=,tag:4NdaWOsIvJPa/j9Ug8KL9Q==,type:str]
ssh_deletekeys: false
ssh_keys:
    # sops-encrypt
    ed25519_private: ENC[AES256_GCM,data:oVlGTdFfFXijTkUK2z/usa8Inj5CsO61QqN81EQVbDEoW2aeDXBHSS5YbX1AD7bZJ1XcbWxtsvI0SnaSomm66sFuufF9vqP6lP5IPQlQi3Azo08Kktb2ok5CeJ4v2BD8CoWXnMTCiLobfCNFFGSImCZP8H89WY54eAgKFkqTQHK63tWVeoKIm4+KzA78UV9+t+TOSkgqD5Hze5z/PqbCxsZse8s3cUj5efK10yG1k/E/cWx0OBxQH3gmxrl7fUPCqwCHwemMWZiQQpsIc4Cbx3lWoRBsI9ZQgd9rHX/ZzChGeR9vS3xwh6HYV3JcFoaKkGQj6bwB1psaaxvjbM+ul6dO5+yh5Ib3GOeFbAozOg3FVcz+cKpWuzoyZn2aV9XH5kqiWiVVWIi0VkmVK/UeTYIiC14yd4UW2nGVvvzGxge2yg1YWM98KwHRoDRWy96W1ANlNkYZvNv1vo7+bpcnbxAVQNM31b7PU6lFCLBwe9UBmetMeaENSauhIAvBNaGpbVnb8SGQB56Jss6ayvOyIf2O5oSd4hoJj9Jf,iv:rFoMYd4gEEFmMXc6IlOFEQOuh+gy6L4qQXI0s0PQcyg=,tag:FlrBOXfFEOWKFraXsgQh7w==,type:str]
    ed25519_public: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIObYWV2oByM30vYbEEF6v2LBNaiVLeNrRpDFHC6ZY4Rd
groups:
    - docker
users:
    - name: teixe
      gecos: Jorge Teixeira
      groups: users,adm,dialout,audio,netdev,video,plugdev,cdrom,games,input,gpio,spi,i2c,render,sudo,docker
      shell: /bin/bash
      ssh_import_id:
        - gh:jorgeteixe
      sudo: ALL=(ALL) NOPASSWD:ALL
apt:
    sources:
        docker:
            source: deb [arch=arm64 signed-by=$KEY_FILE] https://download.docker.com/linux/ubuntu $RELEASE stable
            keyid: 9DC858229FC7DD38854AE2D88D81803C0EBFCD88
        tailscale:
            source: deb [arch=arm64 signed-by=$KEY_FILE] https://pkgs.tailscale.com/stable/ubuntu $RELEASE main
            keyid: 2596A99EAAB33821893C0A79458CA832957F5868
package_update: true
package_upgrade: true
package_reboot_if_required: true
packages:
    - iptables-persistent
    - apt-transport-https
    - curl
    - gnupg
    - git
    - just
    - docker-ce
    - docker-ce-cli
    - containerd.io
    - docker-compose-plugin
    - tailscale
runcmd:
    - su - teixe -c 'gpg --import /home/teixe/gpg-secret.asc'
    - su - teixe -c 'echo "D5F7F738DAA8032D5B6CD6DB5BB088B9813BF479:6:" | gpg --import-ownertrust'
    - rm /home/teixe/gpg-secret.asc
    - service procps force-reload
    - /etc/networkd-dispatcher/routable.d/50-tailscale
    - systemctl enable --now docker
    - curl -L https://github.com/getsops/sops/releases/download/v3.10.2/sops-v3.10.2.linux.arm64 -o /usr/local/bin/sops
    - chmod 755 /usr/local/bin/sops
    - tailscale up --ssh --accept-routes --advertise-tags=tag:homelab-host --advertise-exit-node --advertise-routes=172.20.10.0/24 --authkey $(cat /root/tailscale.authkey)
    - mkdir -p /etc/iptables
    - iptables -t raw -I PREROUTING 1 -i tailscale0 -d 172.20.10.0/24 -j ACCEPT
    - iptables-save > /etc/iptables/rules.v4
    - git clone https://github.com/jorgeteixe/homelab.git /home/teixe/homelab
    - chown -R teixe:teixe /home/teixe/homelab
final_message: System configured after $UPTIME seconds
sops:
    lastmodified: "2025-07-25T21:36:25Z"
    mac: ENC[AES256_GCM,data:2pVwpIA9wLKIwVthNBTOdVMJq2tzkXKBu3ilqGPYBoAq3Vi8V1Vxb1eJeDwQiu9yvl0tLQSGywPpIFUkZeKAtd25miIy7r9Mt1ncNYBO9du9W/QFlzcYhD0lhxyVnB2d8fxzezNKN/Jpc/ZbA8Sw7XqhPKCoSqNSpKU+0UDdWG8=,iv:C3KDIFmzo2Mp0W6fNFJnBZdGtVpqWNv6tssbpJB1L4U=,tag:Lk8NjE12WPgF16koothRgw==,type:str]
    pgp:
        - created_at: "2025-07-25T21:36:25Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hF4DR/nonxQYTxwSAQdA6Zu8j32qjWpJD45znpCLezNcsGESYkFc3mor4X/TziAw
            IWW42faj4J1UbIsNMfoHk08Hm9suIc98tfBg0OefGA68sFiuDSyu3TxlM45HWcSq
            1GYBCQIQuIifw0lHfrDQC/OEw4unZ98EqHpSubPgbQ64JcDQS6LRVDZfL8PO5sPd
            wgCETtSbaLI7GPsc4n/uHMt4vE5bqnhSm5Kvy7YTEtp+mWZrBUVqAMbKWNsJIXkF
            h8P1/CMH7M4=
            =+7ZQ
            -----END PGP MESSAGE-----
          fp: DB6C87F1F82881C053A9692F775C24835DEA222F
        - created_at: "2025-07-25T21:36:25Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA1PyvA0ZNFOVAQ//Szf9FFzIIgr2ldMr69Lqo1EaIZoPZiJO8U1wuuy+ZioH
            vimSAj4ipkY+IixNP+BKtR4DTAM1okrMbEsSJq5cnv4Hht9ytatxKyraeWIVc6VM
            lzWdlFmWEZsg3ihI/QnihOsQeAb26Y7IoIoFDirt46bXyxr7OtUh/kXcuQnaGQKK
            VziCQ3rGcxlcTlAbTmPXOhyk9Z6be/M9Tnk3S+Lj8oA3NVJ9xWtk6XRrExDzdtpY
            BZfHqOIGgIqx6vqkmrBNKk6kqBvZ2QHQQZiUE1UBGz4bOqKa8LUp6iLyVwrrqShf
            1SKUFIMdWx3JBLednQ/WCO0NJy6IXm2Bj6t7M2nL5p2uIjC0ap04jYH7V60NthBg
            xz8oIL8YUd7HwNo5jDY3eQirrxIsyGH3b7UaR8JMFk2yqLhwDXwqVHM3SGzw4/9b
            1FIjW8vtiAo+oDiHsKx2wbhSeKXg7MRThYEulySZ6QbwntE2n2yghm8JSic+gv6H
            QDdll41oVf0s4LtkD4ZJEpYBsnBrmmfAGV2lKcuVISpjwadGxriojYEiOoBOXelY
            c65zLM6nm0DZQXZDpeOtFD/VeD6qOwD85h+uIbKM4+CRsghGnWV+8HQA0IOZtqE6
            xIOdwKNnSQ1DQoXd1c5MtN2G6I05/O/BmdxSWoftCY4uzUbfZ1G0OZMQRLpeNh/U
            ZgEJAhDYhLj9zLls2THIfaPVgdHRCVeMGfjc+kuV6mKH1IoVJ5HEYFV8Q+AmPBHq
            aQ6+Fp5vt/iNm9hWi3HoDnOGnYWHNoapjdCm3sm4xqp/OUZCnJGoqLt0vqWhm/Cq
            DZacctFJ2w==
            =Mu0k
            -----END PGP MESSAGE-----
          fp: D5F7F738DAA8032D5B6CD6DB5BB088B9813BF479
    encrypted_comment_regex: sops-encrypt
    version: 3.10.2
