#cloud-config
hostname: pi-homelab
create_hostname_file: true
manage_etc_hosts: true
timezone: Europe/Madrid
keyboard:
    model: pc105
    layout: es
write_files:
    - path: /etc/systemd/network/99-homelab-macvlan.netdev
      owner: root:root
      permissions: "0644"
      content: |
        [NetDev]
        Name=homelab-link
        Kind=macvlan

        [MACVLAN]
        Mode=bridge
        Parent=eth0
    - path: /etc/systemd/network/99-homelab-macvlan.network
      owner: root:root
      permissions: "0644"
      content: |
        [Match]
        Name=homelab-link

        [Network]
        Address=172.20.10.1/24
    - path: /etc/sysctl.d/99-tailscale.conf
      owner: root:root
      permissions: "0644"
      content: |
        net.ipv4.ip_forward = 1
        net.ipv6.conf.all.forwarding = 1
    - path: /etc/networkd-dispatcher/routable.d/50-tailscale
      owner: root:root
      permissions: "0755"
      content: |
        #!/bin/sh
        ethtool -K eth0 rx-udp-gro-forwarding on rx-gro-list off
    - path: /root/tailscale.authkey
      owner: root:root
      permissions: "0600"
      # sops-encrypt
      content: ENC[AES256_GCM,data:g0xtEQcRMTeVw0sVG661nIKvJOgdaL7ilWBVLWyLSHmn/JKb06HoT8eUwc3KdWQCCNEdIP99pdDgH+gWGKH2rR0=,iv:yp9g2Hix2ASpuMKShHqrliKrqNdI7z0rotVkdSnF2Q4=,tag:nzNlJRUiEMpjlBl9Gj5/4A==,type:str]
    - path: /home/teixe/gpg-secret.asc
      owner: teixe:teixe
      permissions: "0600"
      # sops-encrypt
      content: ENC[AES256_GCM,data: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,iv:Klu74q9TTUpkewEvBMNmUb6z/8KksWApcI7uQ5PQFEo=,tag:xrniWKZvLs1Pjrtv5LNxIQ==,type:str]
ssh_deletekeys: false
ssh_keys:
    # sops-encrypt
    ed25519_private: ENC[AES256_GCM,data:NQ3/a7XGAoPhs/1xIlY/V0q3Lr9BN1AhBD3FvNcQzS7lflONc52vChsS6pEQ5sfeDp04NVgD0sicRCDLWojuSkqXp/iyQkOMoKiy8qjretjPKNhuWfb9hhgULbdnfjfUdjzSGzhwxRpA1X2GNfdvPAMPVWCEpzp8TsxH53Tzr2dP9jgPpZNy3Pub5fs3HZ+6+jzArhWPPtzHIRCO1qp3zHrQ29hmlCkjsPkMom/Iic5u34Pz/TitL75J14WWTjDBNG+WpmO582EZ9Px/1Owx303PlbVen02NcxCnjmNF8EjyDVUvGW569aFGEyHOnK8HoaqSTDS7ybz921w6C2H+hCPEvyjnV69mH89/t37zuJmFpM+HEBAioKlz5TzVrlxemiwVMqGrMLO2qpIZw0rM/v6KssQs/YPVoaO2MvkL6XnqqMk2RiaSy07VrTWwzhXbPIQtED6fXkfvTwMU375yal9i05SwJm/8naBDxokJFFLyE60ggCDw9qEdkSwhbrku0KhwsOjyF3fT5ajKn26laDnrd6T4CZ+l7ZzX,iv:IKchPsmlThPRWbqKbZLPCsrpjLRWtR/tFpjcKge1qT8=,tag:jud49W0+KSBHACl8oMyQWg==,type:str]
    ed25519_public: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIObYWV2oByM30vYbEEF6v2LBNaiVLeNrRpDFHC6ZY4Rd
groups:
    - docker
users:
    - name: teixe
      gecos: Jorge Teixeira
      groups: users,adm,dialout,audio,netdev,video,plugdev,cdrom,games,input,gpio,spi,i2c,render,sudo,docker
      shell: /bin/bash
      ssh_import_id:
        - gh:jorgeteixe
      sudo: ALL=(ALL) NOPASSWD:ALL
apt:
    sources:
        docker:
            source: deb [arch=arm64 signed-by=$KEY_FILE] https://download.docker.com/linux/ubuntu $RELEASE stable
            keyid: 9DC858229FC7DD38854AE2D88D81803C0EBFCD88
        tailscale:
            source: deb [arch=arm64 signed-by=$KEY_FILE] https://pkgs.tailscale.com/stable/ubuntu $RELEASE main
            keyid: 2596A99EAAB33821893C0A79458CA832957F5868
package_update: true
package_upgrade: true
package_reboot_if_required: true
packages:
    - iptables-persistent
    - apt-transport-https
    - curl
    - gnupg
    - git
    - just
    - docker-ce
    - docker-ce-cli
    - containerd.io
    - docker-compose-plugin
    - tailscale
runcmd:
    - su - teixe -c 'gpg --import /home/teixe/gpg-secret.asc'
    - su - teixe -c 'echo "D5F7F738DAA8032D5B6CD6DB5BB088B9813BF479:6:" | gpg --import-ownertrust'
    - rm /home/teixe/gpg-secret.asc
    - service procps force-reload
    - /etc/networkd-dispatcher/routable.d/50-tailscale
    - systemctl enable --now docker
    - curl -L https://github.com/getsops/sops/releases/download/v3.10.2/sops-v3.10.2.linux.arm64 -o /usr/local/bin/sops
    - chmod 755 /usr/local/bin/sops
    - tailscale up --ssh --accept-routes --advertise-tags=tag:homelab-host --advertise-exit-node --advertise-routes=172.20.10.0/24 --authkey $(cat /root/tailscale.authkey)
    - mkdir -p /etc/iptables
    - iptables -t raw -I PREROUTING 1 -i tailscale0 -d 172.20.10.0/24 -j ACCEPT
    - iptables-save > /etc/iptables/rules.v4
    - git clone https://github.com/jorgeteixe/homelab.git /home/teixe/homelab
    - chown -R teixe:teixe /home/teixe/homelab
final_message: System configured after $UPTIME seconds
sops:
    lastmodified: "2025-07-26T08:41:49Z"
    mac: ENC[AES256_GCM,data:dt3XiPZQavRVA6uNdRO46IjkFtg2Phb9ouXBtmj5Pi/Ez9L6VGHMCn4z8DZ+moGRZF1oLMo3rcPIno3mh+TomLZmY1f1BPjGEULHNq0RJNDtCruWEytb1mkst6i/6MH/3lsWM+RC3y+LTvAoVKcwojNGqrCXpFIH6wB6kuFVIPc=,iv:Dx7LUJ6rrHiz4aeMw3EJucxBZcJlutlr3oxqeaMYnCA=,tag:AtStD/Nec9jAh75eKqYAaw==,type:str]
    pgp:
        - created_at: "2025-07-26T08:41:49Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hF4DR/nonxQYTxwSAQdA6WB4OJKpEfYOUUa30a5UKaJwFo506ER0juViAaP5j0sw
            7f9WG4Rum+31ZLs42RSEfaP7t7zq44lUw5a+cXsY7gGEnGnX6hcdp34duztewaYl
            1GgBCQIQ/P2qELnRmkgYG9S51GYrrAZUvO/7z8sQTC8+tTcEz5b8Xe53j3qbCjn9
            YEPjfgKEwQAl5HyOvBBzTT24vMtMB1z5vhk2Nw0P6e7qRNCHoc8dwrrf+Nm+ENt4
            luf3wJm5odEY3A==
            =+5SV
            -----END PGP MESSAGE-----
          fp: DB6C87F1F82881C053A9692F775C24835DEA222F
        - created_at: "2025-07-26T08:41:49Z"
          enc: |-
            -----BEGIN PGP MESSAGE-----

            hQIMA1PyvA0ZNFOVAQ/+KIwUA8yqzR64noRyMGyrQXzzFolAA0dyJ0FJIxf5KjwW
            SN+VhBHdTdklhO+TvLdW6hNnvEFHC9I732ln4qgv24ZiKAU/a4fwmzZ4XvZII5nN
            0s4Wb8Q8gzwK3mCqhI2/+Wdl/nce5l0YWGl2pVUbVanzsk5JopBI+VwSpTocaDMO
            j3AY9AZJLj9mCiz48kX8W0bO7rMzDvRUEpPlLlLcj8AtZqMvrodZ0WPVp4rWW18m
            JYeWYzcE8MkhfkEgg+QyJ4VgKRwrL797dF7aFQADTpXdZ3IW0QnU/Kd/4eW3InKi
            T1myj+LzkcfYrBWQjWmtZjbQLmtAMwd+j/e59xbY6WfeyU3abhPyev4h9+NT2m5F
            NH2Ra+Ga31/Yf7vo344sni1QqSBol2EEtE2vF6wxT4kU7UnmuTSr22esfH4+fSmk
            5dAQ5UY12Cg1+jm+dK0qQUMUZ4mX2WrEB5YwaNcDkhDit1SJPp4PPrk0Brv8bRMg
            Q8lGHUyVOkow2ug7npei24BQCXUQaG9ZC42lVSOs0mT4Lk1FbVOa7sjlScmCVSY/
            EPvck+P/Lv7i+X+nQn4z4Qm1GbRAJ2021rBiorENlpxfP16i2QMDGgioyfnorLVT
            /hJYt4dTu9qR2NdY2WYHs0jTNX1sHMRB5fLSaf8voZDSicK3VupPOOhzlZxUuB7U
            aAEJAhCnXepIDfKtYbQP+9lvbPtXTlEANhS2lTnFk/jVdCz2m7vt520j8vjQwhfB
            4uDmmXi/6YhazsvVRT3XPzktkXOMAxvDN3rWvEQmEWruV13cBMrawNVsCuq50ojT
            uCpCbx93g5xY
            =vzjj
            -----END PGP MESSAGE-----
          fp: D5F7F738DAA8032D5B6CD6DB5BB088B9813BF479
    encrypted_comment_regex: sops-encrypt
    version: 3.10.2
